# [AMAZON-Q-TASK] Critical Security Vulnerability Fix

## Task Overview
Fix 7 moderate security vulnerabilities in frontend dependencies that are blocking production deployment.

## Current State Analysis
Based on PROJECT_HEALTH_AUDIT_REPORT.md:
- 7 moderate severity vulnerabilities detected
- Primary issue: prismjs <1.30.0 DOM Clobbering vulnerability
- Dependency chain: react-syntax-highlighter@15.6.1 → refractor@3.6.0 → prismjs@1.27.0

## Specific Vulnerabilities to Fix

### 1. prismjs DOM Clobbering (CRITICAL)
- **Affected Package**: prismjs@1.27.0 via react-syntax-highlighter
- **CVE**: DOM Clobbering vulnerability
- **Fix Required**: Update to prismjs ≥1.30.0
- **Breaking Change Risk**: HIGH - syntax highlighting may change

### 2. esbuild Development Server (MEDIUM)
- **Affected Package**: esbuild ≤0.24.2 via vite
- **Issue**: Development server vulnerability
- **Fix Required**: Update to vite@7.0.6
- **Breaking Change Risk**: MEDIUM - build configuration may need updates

## Implementation Strategy

### Step 1: Dependency Analysis
```bash
cd frontend
npm audit --audit-level=moderate
npm ls react-syntax-highlighter
npm ls prismjs
```

### Step 2: Safe Update Path
1. **Test Current Functionality**: Document all syntax highlighting usage
2. **Update Strategy**: 
   - Try `npm update` first for non-breaking updates
   - If that fails, manually update react-syntax-highlighter to latest
   - Test all code highlighting components after update

### Step 3: Validation Commands
```bash
# After updates
npm audit --audit-level=moderate  # Should show 0 moderate/high vulnerabilities
npm run build                     # Ensure build still works
npm run test                      # Ensure tests still pass
```

## Files That Use Syntax Highlighting
Based on bundle analysis, check these components:
- Any components importing `react-syntax-highlighter`
- Workflow execution results display
- Code preview components
- Template display components

## Success Criteria
- [ ] `npm audit` shows 0 moderate or high severity vulnerabilities
- [ ] All existing syntax highlighting functionality works unchanged
- [ ] Frontend build completes successfully
- [ ] No new TypeScript errors introduced
- [ ] All existing tests pass

## Rollback Plan
If updates break functionality:
1. Revert package.json changes
2. Run `npm install` to restore previous versions
3. Document specific breaking changes for alternative approach

## Context Files to Reference
- `PROJECT_HEALTH_AUDIT_REPORT.md` - Full vulnerability details
- `frontend/package.json` - Current dependency versions
- `frontend/src/` - Check for syntax highlighter usage

## Expected Timeline
- Analysis: 30 minutes
- Implementation: 1-2 hours
- Testing: 1 hour
- Total: 2-3 hours

## Handoff to Cline
After completion, if any UI components need adjustment due to syntax highlighting changes, create handoff task for Cline with specific component fixes needed.